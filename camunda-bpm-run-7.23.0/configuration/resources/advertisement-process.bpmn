<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" id="sid-38422fae-e03e-43a3-bef4-bd33b32041b2" targetNamespace="http://bpmn.io/bpmn" exporter="Camunda Modeler" exporterVersion="5.35.0">
  <collaboration id="Collaboration_0h53egq">
    <participant id="Participant_0ac01yv" name="Реклама" processRef="Process_1o4wst9" />
    <textAnnotation id="TextAnnotation_03bhxyn">
      <text>Ависасейлс поддерживает разные типы рекламы, это может быть как пост в телеграмме, так и баннер или совместный проект</text>
    </textAnnotation>
    <textAnnotation id="TextAnnotation_0webkyi">
      <text>За допоплительную плату, часть типов реклам может быть настроена на конкретные категории пользователей, например, тех, кто летает бизнес-классом</text>
    </textAnnotation>
    <association id="Association_1xifbag" associationDirection="None" sourceRef="Activity_0in0ffm" targetRef="TextAnnotation_03bhxyn" />
    <association id="Association_06x0ov6" associationDirection="None" sourceRef="Activity_0wh6flo" targetRef="TextAnnotation_0webkyi" />
  </collaboration>
  <process id="Process_1o4wst9" isExecutable="false">
    <laneSet id="LaneSet_1o7mu1g">
      <lane id="Lane_135q4v0" name="Управляющий рекламой">
        <flowNodeRef>Event_0bzwoir</flowNodeRef>
        <flowNodeRef>Activity_1n6ke1y</flowNodeRef>
        <flowNodeRef>Gateway_11th7kx</flowNodeRef>
        <flowNodeRef>Event_125yp0u</flowNodeRef>
        <flowNodeRef>Activity_0q1tegs</flowNodeRef>
        <flowNodeRef>Activity_0lzfwds</flowNodeRef>
        <flowNodeRef>Activity_0jbor2h</flowNodeRef>
        <flowNodeRef>Activity_104ncro</flowNodeRef>
        <flowNodeRef>Event_0ummyet</flowNodeRef>
      </lane>
      <lane id="Lane_14qwmat" name="Сервер">
        <flowNodeRef>Activity_1qx1u5y</flowNodeRef>
        <flowNodeRef>Activity_0in0ffm</flowNodeRef>
        <flowNodeRef>Activity_0wh6flo</flowNodeRef>
        <flowNodeRef>Gateway_03g32fx</flowNodeRef>
        <flowNodeRef>Gateway_1vdoq4x</flowNodeRef>
        <flowNodeRef>Activity_0nmvaew</flowNodeRef>
        <flowNodeRef>Event_1l340sp</flowNodeRef>
        <flowNodeRef>Event_06gwved</flowNodeRef>
        <flowNodeRef>Event_0hnh6uv</flowNodeRef>
      </lane>
    </laneSet>
    <dataStoreReference id="DataStoreReference_1dqzfiu" name="База данных" />
    <startEvent id="Event_0bzwoir" name="Конфигурация рекламы">
      <outgoing>Flow_1ez9sf6</outgoing>
    </startEvent>
    <userTask id="Activity_1n6ke1y" name="Вывод сообщения о необходимости авторизации">
      <extensionElements>
        <camunda:formData>
          <camunda:formField id="auth_error" label="У вас нет прав на использование данного функционала" type="string" defaultValue="У вас нет прав на использование данного функционала">
            <camunda:validation>
              <camunda:constraint name="readonly" />
            </camunda:validation>
          </camunda:formField>
        </camunda:formData>
        <camunda:inputOutput>
          <camunda:outputParameter name="Output_AuthError">У вас нет прав на использование данного функционала</camunda:outputParameter>
        </camunda:inputOutput>
      </extensionElements>
      <incoming>Flow_1f3toz9</incoming>
      <outgoing>Flow_1dp1ego</outgoing>
    </userTask>
    <serviceTask id="Activity_1qx1u5y" name="Проверка токена и прав пользователя" camunda:type="external" camunda:topic="token_validation">
      <extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="Input_JWT">${jwt}</camunda:inputParameter>
        </camunda:inputOutput>
      </extensionElements>
      <incoming>Flow_1ez9sf6</incoming>
      <outgoing>Flow_18yrxey</outgoing>
    </serviceTask>
    <serviceTask id="Activity_0in0ffm" name="Получение типов рекламы" camunda:type="external" camunda:topic="get_advertisements">
      <extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="Input_GetAdvertisementsJWT">${jwt}</camunda:inputParameter>
        </camunda:inputOutput>
      </extensionElements>
      <incoming>Flow_18yrxey</incoming>
      <outgoing>Flow_1f7o0sn</outgoing>
      <property id="Property_1p14d7k" name="__targetRef_placeholder" />
      <dataInputAssociation id="DataInputAssociation_0cnzvz6">
        <sourceRef>DataStoreReference_1dqzfiu</sourceRef>
        <targetRef>Property_1p14d7k</targetRef>
      </dataInputAssociation>
    </serviceTask>
    <exclusiveGateway id="Gateway_11th7kx">
      <incoming>Flow_1dp1ego</incoming>
      <incoming>Flow_0mx9lay</incoming>
      <outgoing>Flow_0loutev</outgoing>
    </exclusiveGateway>
    <endEvent id="Event_125yp0u">
      <incoming>Flow_0loutev</incoming>
    </endEvent>
    <userTask id="Activity_0q1tegs" name="Заполнить информацию о рекламе">
      <incoming>Flow_1f7o0sn</incoming>
      <outgoing>Flow_076xfvl</outgoing>
    </userTask>
    <userTask id="Activity_0lzfwds" name="Вывод сообщения об ошибке">
      <extensionElements>
        <camunda:formData>
          <camunda:formField id="error" label="Произошла ошибка во время выполнения запроса" type="string" defaultValue="Произошла ошибка во время выполнения запроса">
            <camunda:validation>
              <camunda:constraint name="readonly" />
            </camunda:validation>
          </camunda:formField>
        </camunda:formData>
        <camunda:inputOutput>
          <camunda:outputParameter name="Output_Error">Произошла ошибка во время выполнения запроса</camunda:outputParameter>
        </camunda:inputOutput>
      </extensionElements>
      <incoming>Flow_0xqpflz</incoming>
      <outgoing>Flow_0mx9lay</outgoing>
    </userTask>
    <serviceTask id="Activity_0wh6flo" name="Проверка доступности сегментации рекламы">
      <incoming>Flow_076xfvl</incoming>
      <outgoing>Flow_1wehtry</outgoing>
      <property id="Property_0v18r0r" name="__targetRef_placeholder" />
      <dataInputAssociation id="DataInputAssociation_1xck660">
        <sourceRef>DataStoreReference_1dqzfiu</sourceRef>
        <targetRef>Property_0v18r0r</targetRef>
      </dataInputAssociation>
    </serviceTask>
    <exclusiveGateway id="Gateway_03g32fx" name="Сегментация доступна?">
      <incoming>Flow_1wehtry</incoming>
      <outgoing>Flow_1x14qod</outgoing>
      <outgoing>Flow_0men6uy</outgoing>
    </exclusiveGateway>
    <userTask id="Activity_0jbor2h" name="Выбор сегментов">
      <incoming>Flow_1x14qod</incoming>
      <outgoing>Flow_1hby2nt</outgoing>
    </userTask>
    <exclusiveGateway id="Gateway_1vdoq4x">
      <incoming>Flow_0men6uy</incoming>
      <incoming>Flow_1hby2nt</incoming>
      <outgoing>Flow_11d5hic</outgoing>
    </exclusiveGateway>
    <sendTask id="Activity_0nmvaew" name="Создание рекламы в Kafka">
      <incoming>Flow_11d5hic</incoming>
      <outgoing>Flow_1gkzt3w</outgoing>
    </sendTask>
    <userTask id="Activity_104ncro" name="Запрос принят в обработку">
      <incoming>Flow_1gkzt3w</incoming>
      <outgoing>Flow_07gig3m</outgoing>
    </userTask>
    <endEvent id="Event_0ummyet" name="Запрос отправлен в обработку">
      <incoming>Flow_07gig3m</incoming>
    </endEvent>
    <boundaryEvent id="Event_1l340sp" attachedToRef="Activity_0nmvaew">
      <errorEventDefinition id="ErrorEventDefinition_0z70cm2" />
    </boundaryEvent>
    <boundaryEvent id="Event_06gwved" attachedToRef="Activity_0in0ffm">
      <outgoing>Flow_0xqpflz</outgoing>
      <errorEventDefinition id="ErrorEventDefinition_03toc6g" />
    </boundaryEvent>
    <boundaryEvent id="Event_0hnh6uv" attachedToRef="Activity_1qx1u5y">
      <outgoing>Flow_1f3toz9</outgoing>
      <errorEventDefinition id="ErrorEventDefinition_16ng8cl" />
    </boundaryEvent>
    <sequenceFlow id="Flow_1ez9sf6" sourceRef="Event_0bzwoir" targetRef="Activity_1qx1u5y" />
    <sequenceFlow id="Flow_1f3toz9" sourceRef="Event_0hnh6uv" targetRef="Activity_1n6ke1y" />
    <sequenceFlow id="Flow_1dp1ego" sourceRef="Activity_1n6ke1y" targetRef="Gateway_11th7kx" />
    <sequenceFlow id="Flow_18yrxey" sourceRef="Activity_1qx1u5y" targetRef="Activity_0in0ffm" />
    <sequenceFlow id="Flow_1f7o0sn" sourceRef="Activity_0in0ffm" targetRef="Activity_0q1tegs" />
    <sequenceFlow id="Flow_0mx9lay" sourceRef="Activity_0lzfwds" targetRef="Gateway_11th7kx" />
    <sequenceFlow id="Flow_0loutev" sourceRef="Gateway_11th7kx" targetRef="Event_125yp0u" />
    <sequenceFlow id="Flow_076xfvl" sourceRef="Activity_0q1tegs" targetRef="Activity_0wh6flo" />
    <sequenceFlow id="Flow_0xqpflz" sourceRef="Event_06gwved" targetRef="Activity_0lzfwds" />
    <sequenceFlow id="Flow_1wehtry" sourceRef="Activity_0wh6flo" targetRef="Gateway_03g32fx" />
    <sequenceFlow id="Flow_1x14qod" sourceRef="Gateway_03g32fx" targetRef="Activity_0jbor2h" />
    <sequenceFlow id="Flow_0men6uy" sourceRef="Gateway_03g32fx" targetRef="Gateway_1vdoq4x" />
    <sequenceFlow id="Flow_1hby2nt" sourceRef="Activity_0jbor2h" targetRef="Gateway_1vdoq4x" />
    <sequenceFlow id="Flow_11d5hic" sourceRef="Gateway_1vdoq4x" targetRef="Activity_0nmvaew" />
    <sequenceFlow id="Flow_1gkzt3w" sourceRef="Activity_0nmvaew" targetRef="Activity_104ncro" />
    <sequenceFlow id="Flow_07gig3m" sourceRef="Activity_104ncro" targetRef="Event_0ummyet" />
  </process>
  <error id="Error_06j4it2" name="Error_0luaem1" />
  <bpmndi:BPMNDiagram id="BpmnDiagram_1">
    <bpmndi:BPMNPlane id="BpmnPlane_1" bpmnElement="Collaboration_0h53egq">
      <bpmndi:BPMNShape id="Participant_0ac01yv_di" bpmnElement="Participant_0ac01yv" isHorizontal="true">
        <omgdc:Bounds x="160" y="80" width="1320" height="520" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_14qwmat_di" bpmnElement="Lane_14qwmat" isHorizontal="true">
        <omgdc:Bounds x="190" y="330" width="1290" height="270" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_135q4v0_di" bpmnElement="Lane_135q4v0" isHorizontal="true">
        <omgdc:Bounds x="190" y="80" width="1290" height="250" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_1dqzfiu_di" bpmnElement="DataStoreReference_1dqzfiu">
        <omgdc:Bounds x="645" y="505" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="638" y="562" width="67" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0bzwoir_di" bpmnElement="Event_0bzwoir">
        <omgdc:Bounds x="262" y="182" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="243" y="145" width="74" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1n6ke1y_di" bpmnElement="Activity_1n6ke1y">
        <omgdc:Bounds x="360" y="160" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1qx1u5y_di" bpmnElement="Activity_1qx1u5y">
        <omgdc:Bounds x="230" y="380" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1knxy2z_di" bpmnElement="Activity_0in0ffm">
        <omgdc:Bounds x="620" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_11th7kx_di" bpmnElement="Gateway_11th7kx" isMarkerVisible="true">
        <omgdc:Bounds x="515" y="175" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_125yp0u_di" bpmnElement="Event_125yp0u">
        <omgdc:Bounds x="522" y="262" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ae5i2z_di" bpmnElement="Activity_0q1tegs">
        <omgdc:Bounds x="770" y="160" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_037344v_di" bpmnElement="Activity_0lzfwds">
        <omgdc:Bounds x="620" y="160" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0v0hvnf_di" bpmnElement="Activity_0wh6flo">
        <omgdc:Bounds x="880" y="490" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_03g32fx_di" bpmnElement="Gateway_03g32fx" isMarkerVisible="true">
        <omgdc:Bounds x="1025" y="505" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="1016" y="562" width="68" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0zuu0q8_di" bpmnElement="Activity_0jbor2h">
        <omgdc:Bounds x="1000" y="160" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1vdoq4x_di" bpmnElement="Gateway_1vdoq4x" isMarkerVisible="true">
        <omgdc:Bounds x="1145" y="375" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0nmvaew_di" bpmnElement="Activity_0nmvaew">
        <omgdc:Bounds x="1120" y="490" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1tx8hw8_di" bpmnElement="Activity_104ncro">
        <omgdc:Bounds x="1250" y="160" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0ummyet_di" bpmnElement="Event_0ummyet">
        <omgdc:Bounds x="1402" y="182" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="1389" y="225" width="63" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0hnh6uv_di" bpmnElement="Event_0hnh6uv">
        <omgdc:Bounds x="312" y="362" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_06gwved_di" bpmnElement="Event_06gwved">
        <omgdc:Bounds x="702" y="362" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1l340sp_di" bpmnElement="Event_1l340sp">
        <omgdc:Bounds x="1202" y="472" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1ez9sf6_di" bpmnElement="Flow_1ez9sf6">
        <omgdi:waypoint x="280" y="218" />
        <omgdi:waypoint x="280" y="380" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1f3toz9_di" bpmnElement="Flow_1f3toz9">
        <omgdi:waypoint x="330" y="362" />
        <omgdi:waypoint x="330" y="200" />
        <omgdi:waypoint x="360" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dp1ego_di" bpmnElement="Flow_1dp1ego">
        <omgdi:waypoint x="460" y="200" />
        <omgdi:waypoint x="515" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_18yrxey_di" bpmnElement="Flow_18yrxey">
        <omgdi:waypoint x="330" y="420" />
        <omgdi:waypoint x="620" y="420" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1f7o0sn_di" bpmnElement="Flow_1f7o0sn">
        <omgdi:waypoint x="720" y="420" />
        <omgdi:waypoint x="820" y="420" />
        <omgdi:waypoint x="820" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0mx9lay_di" bpmnElement="Flow_0mx9lay">
        <omgdi:waypoint x="620" y="200" />
        <omgdi:waypoint x="565" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0loutev_di" bpmnElement="Flow_0loutev">
        <omgdi:waypoint x="540" y="225" />
        <omgdi:waypoint x="540" y="262" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_076xfvl_di" bpmnElement="Flow_076xfvl">
        <omgdi:waypoint x="870" y="200" />
        <omgdi:waypoint x="930" y="200" />
        <omgdi:waypoint x="930" y="490" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0xqpflz_di" bpmnElement="Flow_0xqpflz">
        <omgdi:waypoint x="703" y="373" />
        <omgdi:waypoint x="670" y="360" />
        <omgdi:waypoint x="670" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1wehtry_di" bpmnElement="Flow_1wehtry">
        <omgdi:waypoint x="980" y="530" />
        <omgdi:waypoint x="1025" y="530" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1x14qod_di" bpmnElement="Flow_1x14qod">
        <omgdi:waypoint x="1050" y="505" />
        <omgdi:waypoint x="1050" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0men6uy_di" bpmnElement="Flow_0men6uy">
        <omgdi:waypoint x="1050" y="505" />
        <omgdi:waypoint x="1050" y="400" />
        <omgdi:waypoint x="1145" y="400" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1hby2nt_di" bpmnElement="Flow_1hby2nt">
        <omgdi:waypoint x="1100" y="200" />
        <omgdi:waypoint x="1170" y="200" />
        <omgdi:waypoint x="1170" y="375" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_11d5hic_di" bpmnElement="Flow_11d5hic">
        <omgdi:waypoint x="1170" y="425" />
        <omgdi:waypoint x="1170" y="490" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1gkzt3w_di" bpmnElement="Flow_1gkzt3w">
        <omgdi:waypoint x="1220" y="530" />
        <omgdi:waypoint x="1300" y="530" />
        <omgdi:waypoint x="1300" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_07gig3m_di" bpmnElement="Flow_07gig3m">
        <omgdi:waypoint x="1350" y="200" />
        <omgdi:waypoint x="1402" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="TextAnnotation_03bhxyn_di" bpmnElement="TextAnnotation_03bhxyn">
        <omgdc:Bounds x="352" y="480" width="258" height="70" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0webkyi_di" bpmnElement="TextAnnotation_0webkyi">
        <omgdc:Bounds x="795" y="620" width="240" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="DataInputAssociation_0cnzvz6_di" bpmnElement="DataInputAssociation_0cnzvz6">
        <omgdi:waypoint x="670" y="505" />
        <omgdi:waypoint x="670" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataInputAssociation_1xck660_di" bpmnElement="DataInputAssociation_1xck660">
        <omgdi:waypoint x="695" y="530" />
        <omgdi:waypoint x="880" y="530" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1xifbag_di" bpmnElement="Association_1xifbag">
        <omgdi:waypoint x="620" y="437" />
        <omgdi:waypoint x="498" y="480" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_06x0ov6_di" bpmnElement="Association_06x0ov6">
        <omgdi:waypoint x="906" y="570" />
        <omgdi:waypoint x="876" y="620" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
